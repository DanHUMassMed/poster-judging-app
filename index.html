<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 16px;
        margin: 0;
      }
      .container {
        max-width: 600px;
        margin: auto;
      }
      h2 {
        color: #2c3e50;
        font-size: 1.5em;
        margin-bottom: 20px;
      }
      label {
        font-weight: bold;
        display: block;
        margin-top: 15px;
        font-size: 1rem;
      }
      select,
      input[type="text"] {
        width: 100%;
        padding: 10px;
        font-size: 1rem;
        margin-top: 5px;
        box-sizing: border-box;
      }
      button {
        margin-top: 20px;
        padding: 12px;
        font-size: 1rem;
        width: 100%;
        background-color: #2c3e50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #34495e;
      }
      #result {
        margin-top: 20px;
        color: green;
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <form id="judgingForm">
    <div class="container">
      <h2>Poster Judging Form</h2>

      <label for="judgeName">Judge Name</label>
      <select id="judgeName"></select>

      <label for="posterTitle">Poster Title</label>
      <select id="posterTitle" onchange="displayPosterDetails()" required></select>

      <div id="posterDetails" style="margin-top: 10px; white-space: pre-wrap; font-size: 0.95rem;"></div>


      <label for="clarity">Scientific Clarity and Rigor (1-5)</label>
      <select id="clarity">
        <option value="1">1</option><option value="2">2</option>
        <option value="3">3</option><option value="4">4</option>
        <option value="5">5</option>
      </select>

      <label for="dataPresentation">Data Presentation and Interpretation (1-5)</label>
      <select id="dataPresentation">
        <option value="1">1</option><option value="2">2</option>
        <option value="3">3</option><option value="4">4</option>
        <option value="5">5</option>
      </select>

      <label for="visualDesign">Visual Design and Organization (1-5)</label>
      <select id="visualDesign">
        <option value="1">1</option><option value="2">2</option>
        <option value="3">3</option><option value="4">4</option>
        <option value="5">5</option>
      </select>

      <label for="innovation">Impact and Innovation (1-5)</label>
      <select id="innovation">
        <option value="1">1</option><option value="2">2</option>
        <option value="3">3</option><option value="4">4</option>
        <option value="5">5</option>
      </select>

      <label for="tiebreaker">Tiebreaker (1-5)</label>
      <select id="tiebreaker">
        <option value="1">1</option><option value="2">2</option>
        <option value="3">3</option><option value="4">4</option>
        <option value="5">5</option>
      </select>

      <button type="submit">Submit</button>
      <p id="result"></p>
    </div>
    </form>
    <script>

        fetch('https://script.google.com/macros/s/AKfycbzW_o_-V61A7duU-yX0stA163O5Lz5TNKtIWeh-oMRJHxVlBqHQRSogY21xSzG0f8e3/exec')
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById('posterTitle');
                data.posters.forEach(p => {
                const o = document.createElement('option');
                o.value = p.title;
                o.text = p.title;
                select.appendChild(o);
                });
                // similarly populate judges dropdown
            })
            .catch(err => console.error(err));

      let posterMap = {}; // Map title -> full poster data

      function loadPosters() {
        google.script.run.withSuccessHandler(function(posters) {
          const select = document.getElementById("posterTitle");
          posterMap = {};

          posters.forEach(poster => {
            const option = document.createElement("option");
            option.text = poster.title;
            option.value = poster.title;
            select.appendChild(option);
            posterMap[poster.title] = poster;
          });
        }).getPostersList();
      }

      function loadJudgeNames() {
        google.script.run.withSuccessHandler(function(judges) {
          const judgeSelect = document.getElementById("judgeName");

          judges.forEach(judge => {
            const option = document.createElement("option");
            option.text = judge;
            option.value = judge;
            judgeSelect.appendChild(option);
          });
        }).getJudgesList();
      }

      function displayPosterDetails() {
        const selectedTitle = document.getElementById("posterTitle").value;
        const poster = posterMap[selectedTitle];
        if (!poster) return;

        const details = `Author: ${poster.author}
    Affiliation: ${poster.affiliation}
    Session: ${poster.session}
    Position: ${poster.position}
    Poster #: ${poster.number}`;

        document.getElementById("posterDetails").innerText = details;
      }

        document.getElementById('judgingForm').addEventListener('submit', e => {
        e.preventDefault();
        const params = new URLSearchParams(new FormData(e.target));
        fetch('https://script.google.com/macros/s/.../exec?' + params)
            .then(r => r.text()).then(msg => alert(msg));
        });


      window.onload = function () {
        loadJudgeNames();
        loadPosters();
      };
    </script>

  </body>
</html>